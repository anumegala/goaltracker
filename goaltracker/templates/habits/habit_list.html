{% extends 'base.html' %}

{% block content %}
  
  <h2 class="highlight-heading mb-3">My Habits</h2>

  <a class="btn btn-primary mb-3" href="{% url 'add_habit' %}">+ Add Habit</a>

  {% for habit in habits %}
    <div class="card mb-4 p-3">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">{{ habit.name }}</h5>
        <a class="btn btn-sm btn-success" href="{% url 'mark_habit' habit.id %}">Mark Today</a>
        <h3>{{ habit.name }}</h3>
        <p>{{ habit.description }}</p>
        <a href="{% url 'edit_habit' habit.id %}" class="btn btn-warning">Edit</a>
        <form method="post" action="{% url 'delete_habit' habit.id %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
      <canvas id="chart-{{ forloop.counter }}" class="mt-3" height="120"></canvas>
    </div>
  {% endfor %}
{% endblock %}

{% block extra_scripts %}
<script>
   const chartData = JSON.parse('{{ chart_data|escapejs }}');
   console.log(chartData);


  chartData.forEach((data, index) => {
    const ctx = document.getElementById(`chart-${index+1}`).getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.dates,
        datasets: [{
          label: 'Progress',
          data: data.values,
          backgroundColor: data.values.map(v => v ? 'green' : 'red'),
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1, callback: v => v ? 'Done' : 'Not' },
            suggestedMax: 1
          }
        }
      }
    });
  });
</script>
{% endblock %}
